<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Mazama Science" />

<meta name="date" content="2021-10-26" />

<title>Introduction to MazamaLocationUtils</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to MazamaLocationUtils</h1>
<h4 class="author">Mazama Science</h4>
<h4 class="date">2021-10-26</h4>



<div id="background" class="section level2">
<h2>Background</h2>
<p>This package is intended for use in data management activities associated with fixed locations in space. The motivating fields include air and water quality monitoring where fixed sensors report at regular time intervals.</p>
<p>When working with environmental monitoring time series, one of the first things you have to do is create unique identifiers for each individual time series. In an ideal world, each environmental time series would have both a <code>deviceID</code> and a <code>locationID</code> that uniquely identify the specific instrument making measurements and the physical location where measurements are made. A unique <code>timeseriesID</code> could be produced as <code>deviceID_locationID</code>. Metadata associated with each <code>timeseriesID</code> would contain basic information needed for downstream analysis including at least:</p>
<p><code>timeseriesID, deviceID, locationID, longitude, latitude, ...</code></p>
<ul>
<li>An extended time series for a mobile sensor would group by <code>deviceID</code>.</li>
<li>Multiple sensors placed at a single location could be be grouped by <code>locationID</code>.</li>
<li>Maps would be created using <code>longitude, latitude</code>.</li>
<li>Time series measurements would be accessed from a secondary <code>data</code> table with <code>timeseriesID</code> column names.</li>
</ul>
<p>Unfortunately, we are rarely supplied with a truly unique and truly spatial <code>locationID</code>. Instead we often use <code>deviceID</code> or an associated non-spatial identifier as a stand-in for <code>locationID</code>.</p>
<p>Complications we have seen include:</p>
<ul>
<li>GPS-reported longitude and latitude can have <em>jitter</em> in the fourth or fifth decimal place making it challenging to use them to create a unique <code>locationID</code>.</li>
<li>Sensors are sometimes <em>repositioned</em> in what the scientist considers the “same location”.</li>
<li>Data from a single sensor goes through different processing pipelines using different identifiers and is later brought together as two separate timeseries.</li>
<li>The spatial scale of what constitutes a “single location” depends on the instrumentation and scientific question being asked.</li>
<li>Deriving location-based metadata from spatial datasets is computationally intensive unless saved and identified with a unique <code>locationID</code>.</li>
<li>Automated searches for spatial metadata occasionally produce incorrect results because of the non-infinite resolution of spatial datasets and must be corrected by hand.</li>
</ul>
</div>
<div id="functionality" class="section level2">
<h2>Functionality</h2>
<p>A solution to all these problems is possible if we store spatial metadata in simple tables in a standard directory. These tables will be referred to as <em>collections</em>. Location lookups can be performed with geodesic distance calculations where a longitude-latitude pair is assigned to a pre-existing <em>known location</em> if it is within <code>distanceThreshold</code> meters of that location. These lookups will be extremely fast.</p>
<p>If no previously <em>known location</em> is found, the relatively slow (seconds) creation of a new <em>known location</em> metadata record can be performed and then added to the growing collection.</p>
<p>For collections of stationary environmental monitors that only number in the thousands, this entire <em>collection</em> can be stored as either a <code>.rda</code> or <code>.csv</code> file and will be under a megabyte in size making it fast to load. This small size also makes it possible to store multiple <em>known locations</em> files, each created with different locations and different distance thresholds to address the needs of different scientific studies.</p>
</div>
<div id="example-usage" class="section level2">
<h2>Example Usage</h2>
<p>The package comes with some example <em>known locations</em> tables.</p>
<p>Lets take some metadata we have for air quality monitors in Washington state and create a <em>known locations</em> table for them.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>wa &lt;-<span class="st"> </span><span class="kw">get</span>(<span class="kw">data</span>(<span class="st">&quot;wa_airfire_meta&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;MazamaLocationUtils&quot;</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">names</span>(wa)</span></code></pre></div>
<pre><code>##  [1] &quot;monitorID&quot;             &quot;longitude&quot;             &quot;latitude&quot;             
##  [4] &quot;elevation&quot;             &quot;timezone&quot;              &quot;countryCode&quot;          
##  [7] &quot;stateCode&quot;             &quot;siteName&quot;              &quot;agencyName&quot;           
## [10] &quot;countyName&quot;            &quot;msaName&quot;               &quot;monitorType&quot;          
## [13] &quot;siteID&quot;                &quot;instrumentID&quot;          &quot;aqsID&quot;                
## [16] &quot;pwfslID&quot;               &quot;pwfslDataIngestSource&quot; &quot;telemetryAggregator&quot;  
## [19] &quot;telemetryUnitID&quot;</code></pre>
<div id="creating-a-known-locations-table" class="section level3">
<h3>Creating a Known Locations table</h3>
<p>We can create a <em>known locations</em> table for them with a minimum 500 meter separation between distinct locations:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(MazamaLocationUtils)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="co"># Initialize with standard directories</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="kw">mazama_initialize</span>()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="kw">setLocationDataDir</span>(<span class="st">&quot;./data&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>wa_monitors_<span class="dv">500</span> &lt;-</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">table_initialize</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">table_addLocation</span>(wa<span class="op">$</span>longitude, wa<span class="op">$</span>latitude, <span class="dt">distanceThreshold =</span> <span class="dv">500</span>) </span></code></pre></div>
<p>Right now, our <em>known locations</em> table contains only automatically generated spatial metadata:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>dplyr<span class="op">::</span><span class="kw">glimpse</span>(wa_monitors_<span class="dv">500</span>)</span></code></pre></div>
<pre><code>## Rows: 68
## Columns: 13
## $ locationID   &lt;chr&gt; &quot;ddbb565d51fe74ba&quot;, &quot;f4ac27b3de8b9c19&quot;, &quot;efce6225e8b2b1b8…
## $ locationName &lt;chr&gt; &quot;us.wa_ddbb56&quot;, &quot;us.wa_f4ac27&quot;, &quot;us.wa_efce62&quot;, &quot;us.wa_3b…
## $ longitude    &lt;dbl&gt; -122.3383, -120.6647, -120.0231, -120.1051, -117.5890, -1…
## $ latitude     &lt;dbl&gt; 47.55998, 47.59880, 47.83861, 48.35412, 47.64535, 47.8852…
## $ elevation    &lt;dbl&gt; 3.19, 361.69, 338.56, 473.18, 729.72, 730.84, 13.03, 175.…
## $ countryCode  &lt;chr&gt; &quot;US&quot;, &quot;US&quot;, &quot;US&quot;, &quot;US&quot;, &quot;US&quot;, &quot;US&quot;, &quot;US&quot;, &quot;US&quot;, &quot;US&quot;, &quot;US…
## $ stateCode    &lt;chr&gt; &quot;WA&quot;, &quot;WA&quot;, &quot;WA&quot;, &quot;WA&quot;, &quot;WA&quot;, &quot;WA&quot;, &quot;WA&quot;, &quot;WA&quot;, &quot;WA&quot;, &quot;WA…
## $ countyName   &lt;chr&gt; &quot;King&quot;, &quot;Chelan&quot;, &quot;Chelan&quot;, &quot;Okanogan&quot;, &quot;Spokane&quot;, &quot;Steve…
## $ timezone     &lt;chr&gt; &quot;America/Los_Angeles&quot;, &quot;America/Los_Angeles&quot;, &quot;America/Lo…
## $ houseNumber  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ street       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ city         &lt;chr&gt; &quot;Seattle&quot;, &quot;Leavenworth&quot;, &quot;Chelan&quot;, &quot;Okanogan County&quot;, &quot;A…
## $ zip          &lt;chr&gt; &quot;98106&quot;, &quot;98826&quot;, &quot;98816&quot;, &quot;98856&quot;, &quot;99001&quot;, &quot;99040&quot;, &quot;98…</code></pre>
</div>
<div id="merging-external-metadata" class="section level3">
<h3>Merging external metadata</h3>
<p>Perhaps we would like to import some of the original metadata into our new table. This is a very common use case where non-spatial metadata like site name or agency responsible for a monitor can be added.</p>
<p>Just to make it interesting, let’s assume that our <em>known locations</em> table is already large and we are only providing additional metadata for a subset of the records.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co"># Use a subset of the wa metadata</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>wa_indices &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">5</span>,<span class="dv">65</span>,<span class="dv">5</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>wa_sub &lt;-<span class="st"> </span>wa[wa_indices,]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="co"># Use a generic name for the location table</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>locationTbl &lt;-<span class="st"> </span>wa_monitors_<span class="dv">500</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a><span class="co"># Find the location IDs associated with our subset</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>locationID &lt;-<span class="st"> </span><span class="kw">table_getLocationID</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>  locationTbl, </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>  <span class="dt">longitude =</span> wa_sub<span class="op">$</span>longitude, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>  <span class="dt">latitude =</span> wa_sub<span class="op">$</span>latitude, </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>  <span class="dt">distanceThreshold =</span> <span class="dv">500</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a><span class="co"># Now add the &quot;siteName&quot; column for our subset of locations</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>locationData &lt;-<span class="st"> </span>wa_sub<span class="op">$</span>siteName</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a>locationTbl &lt;-<span class="st"> </span><span class="kw">table_updateColumn</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a>  locationTbl, </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a>  <span class="dt">columnName =</span> <span class="st">&quot;siteName&quot;</span>, </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a>  <span class="dt">locationID =</span> locationID, </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a>  <span class="dt">locationData =</span> locationData</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a><span class="co"># Lets see how we did</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a>locationTbl_indices &lt;-<span class="st"> </span><span class="kw">table_getRecordIndex</span>(locationTbl, locationID)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a>locationTbl[locationTbl_indices, <span class="kw">c</span>(<span class="st">&quot;city&quot;</span>, <span class="st">&quot;siteName&quot;</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 13 × 2
##    city            siteName                  
##    &lt;chr&gt;           &lt;chr&gt;                     
##  1 Okanogan County Twisp-Ewell St            
##  2 &lt;NA&gt;            &lt;NA&gt;                      
##  3 Tacoma          Tacoma-Alexander Ave      
##  4 Auburn          Auburn 29th St            
##  5 Anacortes       Anacortes-202 Ave (SO-AQS)
##  6 Quincy          Quincy 3rd                
##  7 Tulalip Bay     Tulalip-Totem Beach Rd    
##  8 Shelton         Shelton-W Franklin        
##  9 Ellensburg      Ellensburg-Ruby St        
## 10 Wenatchee       Wenatchee-Fifth St        
## 11 Walla Walla     Walla Walla-12th St       
## 12 Chehalis        Chehalis-Market Blvd      
## 13 Tacoma          Tacoma-S 36th St</code></pre>
<p>Very nice. We have added <code>siteName</code> to our known locations table for a more detailed description of each monitors’ location.</p>
</div>
<div id="finding-known-locations" class="section level3">
<h3>Finding known locations</h3>
<p>The whole point of a known locations table is to speed up access to spatial and other metadata. Here’s how we can use it with a set of longitudes and latitudes that are not currently in our table.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co"># Create new locations near our known locations</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>lons &lt;-<span class="st"> </span><span class="kw">jitter</span>(wa_sub<span class="op">$</span>longitude) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>lats &lt;-<span class="st"> </span><span class="kw">jitter</span>(wa_sub<span class="op">$</span>latitude)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="co"># Any known locations within 50 meters?</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="kw">table_getNearestLocation</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>  wa_monitors_<span class="dv">500</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>  <span class="dt">longitude =</span> lons,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>  <span class="dt">latitude =</span> lats,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>  <span class="dt">distanceThreshold =</span> <span class="dv">50</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">pull</span>(city)</span></code></pre></div>
<pre><code>##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co"># Any known locations within 500 meters</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">table_getNearestLocation</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>  wa_monitors_<span class="dv">500</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>  <span class="dt">longitude =</span> lons,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>  <span class="dt">latitude =</span> lats,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>  <span class="dt">distanceThreshold =</span> <span class="dv">500</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">pull</span>(city)</span></code></pre></div>
<pre><code>##  [1] NA            NA            NA            &quot;Auburn&quot;      NA           
##  [6] &quot;Quincy&quot;      NA            &quot;Shelton&quot;     NA            &quot;Wenatchee&quot;  
## [11] &quot;Walla Walla&quot; NA            &quot;Tacoma&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co"># How about 5000 meters?</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="kw">table_getNearestLocation</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>  wa_monitors_<span class="dv">500</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>  <span class="dt">longitude =</span> lons,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>  <span class="dt">latitude =</span> lats,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>  <span class="dt">distanceThreshold =</span> <span class="dv">5000</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">pull</span>(city)</span></code></pre></div>
<pre><code>##  [1] &quot;Okanogan County&quot; NA                &quot;Tacoma&quot;          &quot;Auburn&quot;         
##  [5] &quot;Anacortes&quot;       &quot;Quincy&quot;          &quot;Tulalip Bay&quot;     &quot;Shelton&quot;        
##  [9] &quot;Ellensburg&quot;      &quot;Wenatchee&quot;       &quot;Walla Walla&quot;     &quot;Chehalis&quot;       
## [13] &quot;Tacoma&quot;</code></pre>
</div>
</div>
<div id="standard-setup" class="section level2">
<h2>Standard Setup</h2>
<p>Before using <strong>MazamaLocationUtils</strong> you must first install <strong>MazamaSpatialUtils</strong> and then install core spatial data with:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>  <span class="kw">library</span>(MazamaSpatialUtils)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>  <span class="kw">setSpatialDataDir</span>(<span class="st">&quot;~/Data/Spatial&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>  <span class="kw">installSpatialData</span>(<span class="st">&quot;EEZCountries&quot;</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>  <span class="kw">installSpatialData</span>(<span class="st">&quot;OSMTimezones&quot;</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>  <span class="kw">installSpatialData</span>(<span class="st">&quot;NaturalEarthAdm1&quot;</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>  <span class="kw">installSpatialData</span>(<span class="st">&quot;USCensusCounties&quot;</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>Once the required datasets have been installed, the easiest way to set things </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a>up each session is with<span class="op">:</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>  <span class="kw">library</span>(MazamaLocationUtils)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>  <span class="kw">mazama_initialize</span>()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>  <span class="kw">setLocationDataDir</span>(<span class="st">&quot;~/Data/KnownLocations&quot;</span>)</span></code></pre></div>
<p><code>mazama_initialize()</code> assumes spatial data are installed in the standard location and is just a wrapper for:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>  MazamaSpatialUtils<span class="op">::</span><span class="kw">setSpatialDataDir</span>(<span class="st">&quot;~/Data/Spatial&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>  </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>  MazamaSpatialUtils<span class="op">::</span><span class="kw">loadSpatialData</span>(<span class="st">&quot;EEZCountries&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>  MazamaSpatialUtils<span class="op">::</span><span class="kw">loadSpatialData</span>(<span class="st">&quot;OSMTimezones&quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>  MazamaSpatialUtils<span class="op">::</span><span class="kw">loadSpatialData</span>(<span class="st">&quot;NaturalEarthAdm1&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>  MazamaSpatialUtils<span class="op">::</span><span class="kw">loadSpatialData</span>(<span class="st">&quot;USCensusCounties&quot;</span>)</span></code></pre></div>
<p>Every time you <code>table_save()</code> your location table, a backup will be created so you can experiment without losing your work. File sizes are pretty tiny so you don’t have to worry about filling up your disk.</p>
<hr />
<p>Best wishes for well organized spatial metadata!</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
